[tools]
go = "1.25.6"
golangci-lint = "2.8.0"

[tasks.install]
run = "go mod download"

[tasks."lint:golangci-lint"]
run = "golangci-lint run"

[tasks.lint]
depends = ["lint:*"]

[tasks."fmt:go"]
run = "go fmt ./..."

[tasks.fmt]
depends = ["fmt:*"]

[tasks.test]
run = "go test -v ./..."

[tasks.codegen]
run = "go mod tidy"

[tasks.ci]
depends = ["lint", "test"]

[tasks.build]
run = """
mkdir build -p
echo "# Built targets"
export CGO_ENABLED=0
go tool dist list | grep -v wasm | while IFS=/ read -r GOOS GOARCH; do
  echo "Building $GOOS/$GOARCH..."
  GOOS=$GOOS GOARCH=$GOARCH go build -v -o build/simple-dashboardd-$GOOS-$GOARCH ./cmd/simple-dashboardd || true
done
"""

[tasks."release:prepare"]
run = """
if [[ ! -z "$NEW_VERSION" ]]; then
  NO_TAG=1 ./make_release "$NEW_VERSION"
fi
"""
